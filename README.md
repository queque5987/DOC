# 프로젝트 개요

이 프로젝트는 언리얼 엔진 5.2를 사용하여 개발된 3인칭 액션 RPG입니다. 절차적으로 생성되는 던전, 깊이 있는 전투 시스템, 그리고 확장 가능한 아키텍처를 특징으로 합니다.

# 주요 기능

- **절차적 던전 생성**: 플레이할 때마다 새로운 구조의 던전을 생성하여 반복 플레이의 재미를 더합니다.
- **다이나믹 전투 시스템**: 일반 공격, 강한 공격, 회피, 카운터 등 다양한 액션을 조합하여 전략적인 전투를 즐길 수 있습니다.
- **지능형 AI**: 비헤이비어 트리(Behavior Tree)를 기반으로 한 적 AI는 플레이어의 행동에 반응하며 다양한 공격 패턴을 구사합니다.
- **최적화된 시스템**: 오브젝트 풀링(Object Pooling)을 적용하여 메모리 사용을 최적화하고 게임 성능을 향상시켰습니다.
- **데이터 기반 시스템**: 아이템, 장비, 스탯 등 게임의 핵심 요소를 데이터 에셋 기반으로 설계하여 확장과 유지보수가 용이합니다.
- **모듈식 아키텍처**: C++ 인터페이스를 적극적으로 활용하여 각 게임 시스템 간의 의존성을 낮추고 유연한 구조를 구현했습니다.

# 기술 상세

### 1. 절차적 던전 생성 (Procedural Dungeon Generation)

- **1.1. 그리드 기반 맵 생성**: `ACGeneratedStage` 클래스를 중심으로 그리드 좌표계를 사용하여 방과 복도를 배치하고, 절차적으로 던전의 기본 구조를 생성합니다.

![image](https://github.com/user-attachments/assets/61eecb1e-3b32-481b-b9da-38bc7a6fb5e7)

그리드 내에 (4*4) 크기의 계단을 생성합니다.

입구의 경우 위층의 좌표에 따라 고정되어 생성되며, 출구의 경우 좌표 내 랜덤하게 생성되도록 하였습니다.

![image](https://github.com/user-attachments/assets/ca3143f0-4e0c-4eef-963f-0ae5fe032e52)

나머지 그리드에 무작위로 노드를 생성하도록 하였습니다.

방의 개수, 띄워져 있어야 할 최소한의 거리 등의 파라미터를 통해 조정할 수 있도록 하였습니다.

![image](https://github.com/user-attachments/assets/a2ea7ccf-6807-4a4e-9995-27c8acbb5a0f)

무작위로 보스 스테이지를 선정하여 (5*5) 크기의 그리드로 확장하였습니다.

- **1.2. 방과 복도 연결 알고리즘**: 각기 독립적으로 생성된 방들을 연결하기 위해 Union-Find 알고리즘으로 그룹화하고, A* 알고리즘을 응용하여 최단 경로의 복도를 생성합니다.

![image](https://github.com/user-attachments/assets/1f0c0f12-2b03-46d5-a33d-5bdc7abf1557)

BFS를 통해 가장 가까운 노드 또는 길에 연결하도록 하였습니다.

연결이 완료될 때마다 Union Find를 사용하여 루트 노드를 업데이트하였고,

서로 다른 루트를 가지는 노드 또는 길에 연결하도록 하여 모든 방이 연결되도록 보장하였습니다.

- **1.3. 동적 레벨 오브젝트 관리**: 플레이어의 시야에 따라 실시간으로 필요한 맵 오브젝트만 렌더링하고 상호작용 가능하도록 하여 레벨의 스케일에 관계없이 일정한 성능을 유지합니다.

![image](https://github.com/user-attachments/assets/c8d24dca-b88d-430d-8bef-634173ce8d9b)

길 끝에 위치해있고 주변이 정돈되어 있는 노드를 (3*3) 크기의 그리드로 확장하였습니다.

### 2. 그리드 기반의 Object Pooling을 활용한 런타임 메모리 최적화

HierarchicalInstancedStaticMeshComponent를 사용하여 던전 내부를 이루는 벽, 오브젝트 등을 구현하였으나,

내비게이션 시스템 사용 등에 있어 어려운 점이 있어 StaticMeshComponent를 사용하기로 결정하였습니다.

각 그리드에 벽, 바닥, 천장 등의 StaticMeshComponent를 소환할 때, ObjectPooling 방식을 적용하여

이미 생성된 컴포넌트의 Transform과 Visibility 등의 파라미터를 변형하여 활용하였습니다.

- **2.1. 오브젝트 풀링 연동**: 던전 내에 배치되는 문, 상자, 몬스터 등 다양한 오브젝트를 `ACGameState_Stage`의 오브젝트 풀에서 가져와 배치함으로써 생성 비용을 최소화합니다.

### 3. 플레이어 전투 시스템

- **3.1. 콤보 공격 시스템**: `ADOCCharacter` 클래스 내에서 좌클릭(LMB)과 우클릭(RMB) 입력에 따라 각각 다른 콤보 공격이 가능하도록 구현했습니다.
- **3.2. 회피 및 카운터 시스템**: 타이밍에 맞춰 회피(Roll)하거나, 적의 공격을 받아치는 카운터(Counter) 시스템을 구현하여 전투에 깊이를 더했습니다.
- **3.3. 애니메이션 기반 히트 판정**: `UCAnimNotifyState_HitTrace` 클래스를 통해 애니메이션의 특정 구간에서만 정확한 히트 판정이 발생하도록 하여 정교한 전투를 구현했습니다.

### 4. 적 AI 시스템

- **4.1. 비헤이비어 트리(Behavior Tree)**: `ACAIController_Minion` 클래스에서 비헤이비어 트리를 사용하여 적의 행동 로직(대기, 추적, 공격 등)을 체계적으로 관리합니다.
- **4.2. AI 시야 시스템 (Perception)**: `AIPerceptionComponent`를 활용하여 플레이어를 감지하고, 시야 범위와 각도에 따라 적의 행동이 변화하도록 설계했습니다.
- **4.3. 상태 관리 및 액션 버퍼링**: 적의 상태(예: 공격 중, 피격)를 관리하고, 플레이어의 행동에 대응하기 위한 액션을 버퍼에 저장하여 자연스러운 AI 반응을 구현했습니다.

### 5. 인벤토리 및 UI 시스템

- **5.1. 데이터 기반 아이템 시스템**: `UCItemData` 데이터 에셋을 활용하여 아이템의 종류, 스탯, 희귀도 등을 관리함으로써, 코드 변경 없이 새로운 아이템을 쉽게 추가할 수 있습니다.
- **5.2. UMG 기반 UI**: 인벤토리, HUD, 아이템 툴팁 등 게임에 필요한 대부분의 UI를 UMG로 구현했으며, C++ 클래스와 연동하여 동적으로 정보를 업데이트합니다.
- **5.3. 동적 캐릭터 스탯 창**: `ACStatusStage` 액터를 통해 인벤토리 창에서 장비 변경 시 캐릭터의 외형과 스탯이 실시간으로 업데이트되는 기능을 구현했습니다.

### 6. 핵심 아키텍처 및 최적화

- **6.1. 인터페이스 기반 설계**: `IPlayerOnStage`, `IEnemyCharacter`, `IObjectPoolManager` 등 다수의 C++ 인터페이스를 정의하고 구현하여, 각 시스템이 독립적으로 작동하고 서로 유연하게 상호작용할 수 있도록 설계했습니다.
- **6.2. 오브젝트 풀링 시스템**: `ACGameState_Stage` 클래스에서 게임에 자주 사용되는 액터(몬스터, 발사체, 이펙트 등)와 컴포넌트(라이트, 스태틱 메시 등)를 미리 생성해두고 재활용하는 오브젝트 풀링 시스템을 구현하여 성능을 최적화했습니다.